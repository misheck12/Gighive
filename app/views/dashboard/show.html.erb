<div class="dashboard-container py-5" style="background-color: #f8f9fa;">
  <div class="container">
    <h3 class="mb-4 text-warning">Welcome, <%= current_user.name %>!</h3>

    <% if current_user.admin? %>
      <ul class="nav nav-tabs nav-fill mb-4 shadow-sm bg-white rounded-top" id="adminDashboardTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <a class="nav-link active font-weight-bold" id="pending-payments-tab" data-bs-toggle="tab" href="#pending-payments" role="tab" aria-controls="pending-payments" aria-selected="true">
            <i class="fas fa-hourglass-half mr-2"></i>Pending Payments
          </a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link font-weight-bold" id="accepted-payments-tab" data-bs-toggle="tab" href="#accepted-payments" role="tab" aria-controls="accepted-payments" aria-selected="false">
            <i class="fas fa-check-circle mr-2"></i>Accepted Payments
          </a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link font-weight-bold" id="rejected-payments-tab" data-bs-toggle="tab" href="#rejected-payments" role="tab" aria-controls="rejected-payments" aria-selected="false">
            <i class="fas fa-times-circle mr-2"></i>Rejected Payments
          </a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link font-weight-bold" id="all-tasks-tab" data-bs-toggle="tab" href="#all-tasks" role="tab" aria-controls="all-tasks" aria-selected="false">
            <i class="fas fa-tasks mr-2"></i>All Tasks
          </a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link font-weight-bold" id="all-reviews-tab" data-bs-toggle="tab" href="#all-reviews" role="tab" aria-controls="all-reviews" aria-selected="false">
            <i class="fas fa-star mr-2"></i>All Reviews
          </a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link font-weight-bold" id="manage-users-tab" data-bs-toggle="tab" href="#manage-users" role="tab" aria-controls="manage-users" aria-selected="false">
            <i class="fas fa-users-cog mr-2"></i>Manage Users
          </a>
        </li>
      </ul>

      <div class="tab-content shadow-sm bg-white rounded-bottom" id="adminDashboardContent">
        <div class="tab-pane fade show active" id="pending-payments" role="tabpanel" aria-labelledby="pending-payments-tab">
          <div class="table-responsive p-3">
            <% if @pending_payments.present? %>
              <table class="table table-striped table-hover">
                <thead class="table-light">
                  <tr>
                    <th>#</th>
                    <th>Task Title</th>
                    <th>Amount</th>
                    <th>Transaction ID</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @pending_payments.each do |payment| %>
                    <tr>
                      <td><%= payment.id %></td>
                      <td><%= link_to payment.task.title, task_path(payment.task), class: 'text-decoration-none' %></td>
                      <td><%= humanized_money_with_symbol(payment.task.budget) %></td>
                      <td><%= payment.transaction_id %></td>
                      <td>
                        <%= link_to 'View', task_payment_path(payment.task_id, payment.id), class: 'btn btn-primary btn-sm' %>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            <% else %>
              <p class="mt-3 p-3 text-muted">No pending payments at this time.</p>
            <% end %>
          </div>
        </div>

        <div class="tab-pane fade" id="accepted-payments" role="tabpanel" aria-labelledby="accepted-payments-tab">
          <div class="table-responsive p-3">
          <% accepted_payments = Payment.where(status: 'approved') %>
          <% if accepted_payments.present? %>
            <table class="table table-striped table-hover">
              <thead class="table-light">
                <tr>
                  <th>#</th>
                  <th>Task Title</th>
                  <th>Amount</th>
                  <th>Transaction ID</th>
                  <th>Freelancer</th>
                  <th>User</th>
                </tr>
              </thead>
              <tbody>
                <% accepted_payments.each do |payment| %>
                  <tr>
                    <td><%= payment.id %></td>
                    <td><%= link_to payment.task.title, task_path(payment.task), class: 'text-decoration-none' %></td>
                    <td><%= humanized_money_with_symbol(payment.task.budget) %></td>
                    <td><%= payment.transaction_id %></td>
                    <td><%= payment.task.freelancer.name %></td>
                    <td><%= payment.task.client.email %></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          <% else %>
            <p class="mt-3 p-3 text-muted">No accepted payments at this time.</p>
          <% end %>
          </div>
        </div>

        <div class="tab-pane fade" id="rejected-payments" role="tabpanel" aria-labelledby="rejected-payments-tab">
          <div class="table-responsive p-3">
            <% rejected_payments = Payment.where(status: 'rejected') %>
            <% if rejected_payments.present? %>
              <table class="table table-striped table-hover">
                <thead class="table-light">
                  <tr>
                    <th>#</th>
                    <th>Task Title</th>
                    <th>Amount</th>
                    <th>Transaction ID</th>
                    <th>Freelancer</th>
                    <th>User</th>
                  </tr>
                </thead>
                <tbody>
                  <% rejected_payments.each do |payment| %>
                    <tr>
                      <td><%= payment.id %></td>
                      <td><%= link_to payment.task.title, task_path(payment.task), class: 'text-decoration-none' %></td>
                      <td><%= humanized_money_with_symbol(payment.task.budget) %></td>
                      <td><%= payment.transaction_id %></td>
                      <td><%= payment.task.freelancer.name %></td>
                      <td><%= payment.task.client.email %></td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            <% else %>
              <p class="mt-3 p-3 text-muted">No rejected payments at this time.</p>
            <% end %>
          </div>
        </div>

        <div class="tab-pane fade" id="all-tasks" role="tabpanel" aria-labelledby="all-tasks-tab">
          <div class="card mt-3">
            <div class="card-header bg-light font-weight-bold">
              <i class="fas fa-list mr-2"></i>All Tasks
            </div>
            <div class="card-body">
              <ul class="list-group list-group-flush">
                <% Task.all.each do |task| %>
                  <li class="list-group-item">
                    <%= link_to task.title, task_path(task), class: 'text-decoration-none' %> -
                    <span class="badge <%= badge_color_for_status(task.status) %>"><%= task.status.titleize %></span>
                  </li>
                <% end %>
              </ul>
            </div>
          </div>
        </div>

        <div class="tab-pane fade" id="all-reviews" role="tabpanel" aria-labelledby="all-reviews-tab">
          <div class="card mt-3">
            <div class="card-header bg-light font-weight-bold">
              <i class="fas fa-star mr-2"></i>All Reviews
            </div>
            <div class="card-body">
              <ul class="list-group list-group-flush">
                <% Review.all.each do |review| %>
                  <li class="list-group-item">
                    Review for <%= link_to review.task.title, task_path(review.task), class: 'text-decoration-none' %>:
                    <span class="badge <%= badge_color_for_rating(review.rating) %>"><%= review.rating %> stars</span> - <%= review.comment %>
                  </li>
                <% end %>
              </ul>
            </div>
          </div>
        </div>

        <div class="tab-pane fade" id="manage-users" role="tabpanel" aria-labelledby="manage-users-tab">
          <div class="p-3">
            <h4 class="mb-3"><i class="fas fa-users-cog mr-2"></i>Manage Users</h4>
            <div class="table-responsive">
              <table class="table table-bordered table-hover">
                <thead class="thead-light">
                  <tr>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% User.all.each do |user| %>
                    <tr>
                      <td><%= user.email %></td>
                      <td><%= user.role.capitalize %></td>
                      <td>
                        <%= link_to 'Delete', admin_destroy_user_path(user), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger btn-sm' %>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
            <%= link_to 'Create New User', new_freelancer_registration_path, class: 'btn btn-primary mt-3' %>
          </div>
        </div>
      </div>

    <% elsif current_user.client? %>
      <ul class="nav nav-tabs nav-fill mb-4 shadow-sm bg-white rounded-top" id="clientDashboardTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <a class="nav-link active font-weight-bold" id="client-tasks-tab" data-bs-toggle="tab" href="#client-tasks" role="tab" aria-controls="client-tasks" aria-selected="true">
            <i class="fas fa-tasks mr-2"></i>My Tasks
          </a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link font-weight-bold" id="client-payments-tab" data-bs-toggle="tab" href="#client-payments" role="tab" aria-controls="client-payments" aria-selected="false">
            <i class="fas fa-money-check-alt mr-2"></i>Payments
          </a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link font-weight-bold" id="client-reviews-tab" data-bs-toggle="tab" href="#client-reviews" role="tab" aria-controls="client-reviews" aria-selected="false">
            <i class="fas fa-star mr-2"></i>Reviews
          </a>
        </li>
      </ul>

      <div class="tab-content shadow-sm bg-white rounded-bottom" id="clientDashboardContent">
        <div class="tab-pane fade show active" id="client-tasks" role="tabpanel" aria-labelledby="client-tasks-tab">
          <div class="card mt-3">
            <div class="card-header bg-light text-dark font-weight-bold">
              <i class="fas fa-tasks mr-2"></i>Your Tasks
            </div>
            <div class="card-body">
              <%= link_to 'Create New Task', new_task_path, class: "btn btn-primary mb-3" %>

              <% Task.statuses.keys.each do |status| %>
                <div class="my-4">
                  <h5 class="text-primary mb-3">Your Tasks - <%= status.titleize %></h5>
                  <div class="table-responsive">
                    <table class="table table-bordered table-hover">
                      <thead class="thead-dark">
                        <tr>
                          <th>Title</th>
                          <th>Description</th>
                          <th>Budget</th>
                          <th>Category</th>
                          <th>Deadline</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% current_user.tasks_as_client.where(status: status).each do |task| %>
                          <tr>
                            <td><%= content_tag :span, task.title, class: 'btn-disabled text-black' %></td>
                            <td><%= task.description %></td>
                            <td><%= humanized_money_with_symbol(task.budget) %></td>
                            <td><%= task.category.name %></td>
                            <td>
                              <span class="countdown" data-deadline="<%= task.deadline %>"></span>
                            </td>
                            <td><span class="badge <%= badge_color_for_status(task.status) %>"><%= task.status.titleize %></span></td>
                            <td>
                              <% if task.completed? %>
                                <% if task.payment.nil? %>
                                  <%= link_to 'Pay', new_task_payment_path(task), class: 'btn btn-success btn-sm' %>
                                <% elsif task.payment.rejected? %>
                                  <span class="badge badge-danger">Rejected</span>
                                  <%= link_to 'Pay Again', new_task_payment_path(task), class: 'btn btn-success btn-sm' %>
                                <% elsif task.payment.approved? %>
                                  <%= link_to 'View', task_path(task), class: 'btn btn-primary btn-sm' %>
                                <% end %>
                              <% end %>
                            </td>
                          </tr>
                        <% end %>
                      </tbody>
                    </table>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <div class="tab-pane fade" id="client-payments" role="tabpanel" aria-labelledby="client-payments-tab">
          <div class="card mt-3">
            <div class="card-header bg-light text-dark font-weight-bold">
              <i class="fas fa-money-check-alt mr-2"></i>Payments
            </div>
            <div class="card-body">
              <div class="payments-info mb-4 p-3 border rounded">
                <h5 class="text-primary">Payment Methods</h5>
                <p>For payments, you can transfer funds to the following mobile numbers:</p>
                <ul class="list-group list-group-flush">
                  <li class="list-group-item">MTN: <span class="font-weight-bold">+260960231978</span></li>
                  <li class="list-group-item">Airtel: <span class="font-weight-bold">+260777945779</span></li>
                </ul>
              </div>

              <% accepted_payments = Payment.where(status: 'approved', task: current_user.tasks_as_client) %>
              <% if accepted_payments.present? %>
                <h5 class="text-primary mb-3">Accepted Payments</h5>
                <div class="table-responsive">
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Task Title</th>
                        <th>Amount</th>
                        <th>Transaction ID</th>
                        <th>Freelancer</th>
                        <th>User</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% accepted_payments.each do |payment| %>
                        <tr>
                          <td><%= payment.id %></td>
                          <td><%= payment.task.title %></td>
                          <td><%= humanized_money_with_symbol(payment.task.budget) %></td>
                          <td><%= payment.transaction_id %></td>
                          <td><%= payment.task.freelancer.name %></td>
                          <td><%= payment.task.client.email %></td>
                        </tr>
                      <% end %>
                    </tbody>
                  </table>
                </div>
              <% else %>
                <p>No accepted payments at this time.</p>
              <% end %>
            </div>
          </div>
        </div>

        <div class="tab-pane fade" id="client-reviews" role="tabpanel" aria-labelledby="client-reviews-tab">
          <div class="card mt-3">
            <div class="card-header bg-light text-dark font-weight-bold">
              <i class="fas fa-star mr-2"></i>Reviews
            </div>
            <div class="card-body">
              <ul class="list-group list-group-flush">
                <% if current_user&.given_reviews&.any? %>
                  <% current_user.given_reviews.each do |review| %>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                     Review for <%= link_to review.task.
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                      Review for <%= link_to review.task.title, task_path(review.task), class: 'text-primary' %>
                      <span class="badge <%= badge_color_for_rating(review.rating) %> badge-pill"><%= review.rating %> stars</span> - <%= review.comment %>
                    </li>
                  <% end %>
                <% else %>
                  <li class="list-group-item">No reviews available.</li>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
      </div>

    <% elsif current_user.freelancer? %>
      <div class="card shadow mb-4 animated fadeIn">
        <div class="card-header bg-warning text-white font-weight-bold">
          <i class="fas fa-hand-holding-usd mr-2"></i>Total Earning
        </div>
        <div class="card-body">
          <p>Your total earning: <span class="font-weight-bold"><%= current_user.email %></span></p>
          <h2 class="text-warning"><%= humanized_money_with_symbol(Task.total_earning_for_freelancer(current_user.id).pluck(:budget).sum.to_f * 0.8, symbol: "ZMK", position: :before) %></h2>
        </div>
      </div>

      <ul class="nav nav-tabs nav-fill mb-4 shadow-sm bg-white rounded-top" id="freelancerDashboardTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <a class="nav-link active font-weight-bold" id="available-tasks-tab" data-bs-toggle="tab" href="#available-tasks" role="tab" aria-controls="available-tasks" aria-selected="true">
            <i class="fas fa-list-alt mr-2"></i>Available Tasks
          </a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link font-weight-bold" id="working-tasks-tab" data-bs-toggle="tab" href="#working-tasks" role="tab" aria-controls="working-tasks" aria-selected="false">
            <i class="fas fa-briefcase mr-2"></i>Your Tasks
          </a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link font-weight-bold" id="tasks-changes-tab" data-bs-toggle="tab" href="#tasks-changes" role="tab" aria-controls="tasks-changes" aria-selected="false">
            <i class="fas fa-exclamation-triangle mr-2"></i>Tasks Requiring Changes
          </a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link font-weight-bold" id="reviews-received-tab" data-bs-toggle="tab" href="#reviews-received" role="tab" aria-controls="reviews-received" aria-selected="false">
            <i class="fas fa-star mr-2"></i>Reviews Received
          </a>
        </li>
      </ul>

      <div class="tab-content shadow-sm bg-white rounded-bottom" id="freelancerDashboardContent">
        <div class="tab-pane fade show active" id="available-tasks" role="tabpanel" aria-labelledby="available-tasks-tab">
          <div class="card mt-3">
            <div class="card-body">
              <h4 class="text-secondary"><i class="fas fa-list-alt mr-2"></i>Available Tasks</h4>
              <div class="table-responsive">
                <table class="table table-bordered table-hover">
                  <thead class="table-light">
                    <tr>
                      <th>Title</th>
                      <th>Description</th>
                      <th>Earning</th>
                      <th>Category</th>
                      <th>Deadline</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% Task.open_tasks.each do |task| %>
                      <tr>
                        <td><%= link_to task.title, task_path(task), class: 'text-primary color-black' %></td>
                        <td><%= truncate(task.description, length: 100) %></td>
                        <td><%= humanized_money_with_symbol(task.budget * 0.80) %></td>
                        <td><%= task.category.name %></td>
                        <td><%= l(task.deadline, format: :short) %></td>
                        <td>
                          <span class="badge bg-success"><%= task.status.titleize %></span>
                        </td>
                      </tr>
                    <% end %>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <div class="tab-pane fade" id="working-tasks" role="tabpanel" aria-labelledby="working-tasks-tab">
          <div class="card mt-3">
            <div class="card-body">
              <h4 class="text-secondary"><i class="fas fa-briefcase mr-2"></i>Tasks You're Working On</h4>
              <div class="table-responsive">
                <table class="table table-bordered table-hover">
                  <thead class="table-light">
                    <tr>
                      <th>Title</th>
                      <th>Description</th>
                      <th>Budget</th>
                      <th>Category</th>
                      <th>Deadline</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% current_user.tasks_as_freelancer.each do |task| %>
                      <tr>
                        <td><%= link_to task.title, task_path(task), class: 'text-primary' %></td>
                        <td><%= truncate(task.description, length: 100) %></td>
                        <td><%= humanized_money_with_symbol(task.budget * 0.80) %></td>
                        <td><%= task.category.name %></td>
                        <td><%= l(task.deadline, format: :short) %></td>
                        <td>
                          <span class="badge <%= badge_color_for_status(task.status) %>"><%= task.status.titleize %></span>
                        </td>
                      </tr>
                    <% end %>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <div class="tab-pane fade" id="tasks-changes" role="tabpanel" aria-labelledby="tasks-changes-tab">
          <div class="card mt-3">
            <div class="card-body">
              <% if current_user.tasks_requiring_changes.any? %>
                <h4 class="text-secondary"><i class="fas fa-exclamation-triangle mr-2"></i>Tasks Requiring Changes</h4>
                <div class="table-responsive">
                  <table class="table table-bordered table-hover">
                    <thead class="table-light">
                      <tr>
                        <th>Title</th>
                        <th>Description</th>
                        <th>Budget</th>
                        <th>Category</th>
                        <th>Deadline</th>
                        <th>Status</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% current_user.tasks_requiring_changes.each do |task| %>
                        <tr>
                          <td><%= link_to task.title, task_path(task), class: 'text-primary' %></td>
                          <td><%= truncate(task.description, length: 100) %></td>
                          <td><%= humanized_money_with_symbol(task.budget * 0.80) %></td>
                          <td><%= task.category.name %></td>
                          <td><%= l(task.deadline, format: :short) %></td>
                          <td>
                            <span class="badge <%= badge_color_for_status(task.status) %>"><%= task.status.titleize %></span>
                          </td>
                          <td>
                            <%= link_to 'View Task', task_path(task), class: 'btn btn-primary btn-sm' %>
                          </td>
                        </tr>
                      <% end %>
                    </tbody>
                  </table>
                </div>
              <% else %>
                <p class="text-muted">No tasks requiring changes at the moment.</p>
              <% end %>
            </div>
          </div>
        </div>

        <div class="tab-pane fade" id="reviews-received" role="tabpanel" aria-labelledby="reviews-received-tab">
          <div class="card mt-3">
            <div class="card-body">
              <% if current_user.reviews_received.any? %>
                <h4 class="text-secondary"><i class="fas fa-star mr-2"></i>Reviews Received</h4>
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead class="table-light">
                      <tr>
                        <th>Task Title</th>
                        <th>Rating</th>
                        <th>Comment</th>
                        <th>Reviewed By</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% current_user.reviews_received.each do |review| %>
                        <tr>
                          <td><%= link_to review.task.title, task_path(review.task) %></td>
                          <td><%= review.rating %> stars</td>
                          <td><%= review.comment %></td>
                          <td><%= review.reviewer.email %></td>
                        </tr>
                      <% end %>
                    </tbody>
                  </table>
                </div>
              <% else %>
                <p class="text-muted">No reviews received yet.</p>
              <% end %>
            </div>
          </div>
        </div>
      </div>

    <% end %>

    <style>
      .animated {
        animation-duration: 1s;
        animation-fill-mode: both;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }

        to {
          opacity: 1;
        }
      }

      .fadeIn {
        animation-name: fadeIn;
      }

      .nav-tabs .nav-link {
        color: #495057; /* Default tab color */
      }

      .nav-tabs .nav-link:hover {
        color: #FFD700; /* Hover tab color */
      }

      .nav-tabs .nav-link.active {
        color: #FFD700; /* Active tab color */
        border-color: #FFD700; /* Active tab border color */
      }

      /* Custom styling for badges based on task status */
      .badge {
        font-size: 0.9rem;
        padding: 0.3rem 0.6rem;
        border-radius: 10rem;
        margin-bottom: 5px;
        font-weight: 500;
      }

      .badge-primary {
          background-color: #007bff;
      }

      .badge-secondary {
          background-color: #6c757d;
      }

      .badge-success {
          background-color: #28a745;
      }

      .badge-danger {
          background-color: #dc3545;
      }

      .badge-warning {
          background-color: #ffc107;
      }

      .badge-info {
          background-color: #17a2b8;
      }

      .badge-light {
          background-color: #f8f9fa;
          color: #343a40;
      }

      .badge-dark {
          background-color: #343a40;
      }

      .text-warning {
        color: #FFD700; /* Your specific color for welcome message */
      }

      .font-weight-bold {
        font-weight: bold;
      }
    </style>
  </div>
</div>